{"ast":null,"code":"import _regeneratorRuntime from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/direction/Directions/Map.jsx\";\nimport React, { Component } from \"react\";\nimport { here } from \"../../../config/constants\";\nimport _ from \"lodash\";\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from \"reactstrap\";\nimport WebService from \"../../../services/WebService\"; // import WebService from \"../../../services/WebService\";\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  // m\n  function Map(props) {\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Map).call(this, props));\n    _this.MAX_DIS = 100;\n    _this.themes = [\"normal.day\", \"normal.day.grey\", \"normal.day.transit\", \"normal.night\", \"normal.night.grey\", \"reduced.night\", \"reduced.day\", \"pedestrian.day\", \"pedestrian.night\"];\n    _this.image = \"https://img.icons8.com/color/48/000000/marker.png\";\n\n    _this.componentWillMount = function () {\n      var _this$props = _this.props,\n          lat = _this$props.lat,\n          lng = _this$props.lng,\n          zoom = _this$props.zoom;\n\n      _this.setState({\n        center: {\n          lat: lat ? lat : 0,\n          lng: lng ? lng : 0\n        },\n        zoom: zoom\n      });\n    };\n\n    _this.componentDidMount = function () {\n      _this.drawMap();\n    };\n\n    _this.componentWillReceiveProps = function (nextProps) {\n      _this.setState({\n        center: {\n          lat: nextProps.lat,\n          lng: nextProps.lng\n        }\n      });\n\n      _this.drawMap();\n    };\n\n    _this.prepareLayout = function () {\n      _this.platform = new window.H.service.Platform(_this.state); // create layer to draw map\n\n      var pixelRatio = window.devicePixelRatio || 1;\n      _this.layer = _this.platform.createDefaultLayers({\n        tileSize: pixelRatio === 1 ? 256 : 512,\n        ppi: pixelRatio === 1 ? undefined : 320\n      }); // get div container to where to draw\n\n      var container = document.getElementById(\"here-map\"); //crate map with layer & container created\n\n      _this.map = new window.H.Map(container, _this.layer.normal.map, {\n        center: _this.state.center,\n        zoom: _this.state.zoom,\n        pixelRatio: pixelRatio\n      });\n\n      var mapTileService = _this.platform.getMapTileService({\n        type: \"base\"\n      }),\n          vietnameseMapLayer = mapTileService.createTileLayer(\"maptile\", _this.themes[0], pixelRatio === 1 ? 256 : 512, \"png8\", {\n        lg: \"vie\",\n        ppi: pixelRatio === 1 ? undefined : 320\n      });\n\n      _this.map.setBaseLayer(vietnameseMapLayer);\n\n      _this.events = new window.H.mapevents.MapEvents(_this.map);\n      _this.behavior = new window.H.mapevents.Behavior(_this.events);\n      _this.ui = window.H.ui.UI.createDefault(_this.map, _this.layer, \"zh-CN\");\n    };\n\n    _this.drawMap =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state$center, lat, lng, parisMarker;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.prepareLayout();\n\n              _this$state$center = _this.state.center, lat = _this$state$center.lat, lng = _this$state$center.lng;\n              parisMarker = new window.H.map.Marker({\n                lat: lat,\n                lng: lng\n              });\n\n              _this.map.addObject(parisMarker);\n\n              _context.next = 6;\n              return _this.geocode();\n\n            case 6:\n              _this.findNearestMarker();\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.geocode = function () {\n      var addresses = _this.props.address;\n\n      if (addresses) {\n        _.map(addresses, function (item, index) {\n          var address = item.address;\n\n          var geocoder = _this.platform.getGeocodingService();\n\n          var geocodingParameters = {\n            searchText: address,\n            jsonattributes: 1\n          };\n          geocoder.geocode(geocodingParameters, function (result) {\n            var locations = result.response.view[0].result;\n\n            _this.addLocationsToMap(locations[0], item.id, index);\n          }, function (error) {\n            console.log(\"Error when geocode address\");\n          });\n        });\n      }\n    };\n\n    _this.addLocationsToMap = function (location, id, index) {\n      var group = new window.H.map.Group();\n      var position = {};\n      position = {\n        lat: location.location.displayPosition.latitude,\n        lng: location.location.displayPosition.longitude\n      };\n      var myIcon = new window.H.map.Icon(_this.image);\n      var html = \"<div> Chi nhánh \" + location.location.address.label + \"</div>\";\n      _this.marker = new window.H.map.Marker(position, {\n        icon: myIcon\n      });\n\n      _this.marker.setData(html);\n\n      _this.marker.draggable = true;\n      group.addObject(_this.marker);\n\n      _this.map.addObject(group);\n\n      _this.map.setCenter(group.getBounds().getCenter()); // distance to current position\n\n\n      var distance = group.getObjects()[0].getPosition().distance(_this.state.center); // update location for stores\n\n      WebService.updateLocation(position, distance, id).then(function (res) {\n        console.log(res);\n      }).catch(function (err) {\n        console.log(err);\n      }); //get info of store address when click map\n\n      group.addEventListener(\"tap\", function (evt) {\n        var bubble = new window.H.ui.InfoBubble(evt.target.getPosition(), {\n          content: evt.target.getData()\n        });\n\n        _this.ui.addBubble(bubble);\n      }, false);\n    };\n\n    _this.findNearestMarker = function () {\n      WebService.getAllLocation().then(function (res) {\n        var stores = JSON.parse(res).addresses;\n        var distance = stores[0].distance;\n        _this.nearestStore = stores[0];\n\n        _.map(stores, function (item) {\n          if (item.distance < distance) _this.nearestStore = item;\n        });\n\n        _this.calculateRouteFromAtoB();\n      }).catch(function (err) {\n        console.log(err);\n      });\n    };\n\n    _this.calculateRouteFromAtoB = function () {\n      var position = JSON.parse(_this.nearestStore.location);\n      var point1 = _this.state.center.lat + \",\" + _this.state.center.lng;\n      var point2 = position.lat + \",\" + position.lng;\n      console.log(point1);\n      console.log(point2);\n\n      var router = _this.platform.getRoutingService(),\n          routeRequestParams = {\n        mode: \"fastest;car\",\n        representation: \"display\",\n        waypoint0: point1,\n        waypoint1: point2,\n        routeattributes: \"waypoints,summary,shape,legs\",\n        maneuverattributes: \"direction,action\"\n      };\n\n      router.calculateRoute(routeRequestParams, function (result) {\n        var route = result.response.route[0];\n\n        _this.addRouteShapeToMap(route);\n\n        _this.addManueversToMap(route);\n      }, function (err) {\n        alert(\"Ooops!\");\n      });\n    };\n\n    _this.addRouteShapeToMap = function (route) {\n      var strip = new window.H.geo.Strip(),\n          routeShape = route.shape,\n          polyline;\n      routeShape.forEach(function (point) {\n        var parts = point.split(\",\");\n        strip.pushLatLngAlt(parts[0], parts[1]);\n      });\n      polyline = new window.H.map.Polyline(strip, {\n        style: {\n          lineWidth: 4,\n          strokeColor: \"rgba(0, 128, 255, 0.7)\"\n        }\n      }); // Add the polyline to the map\n\n      _this.map.addObject(polyline); // And zoom to its bounding rectangle\n\n\n      _this.map.setViewBounds(polyline.getBounds(), true);\n    };\n\n    _this.addManueversToMap = function (route) {\n      var svgMarkup = '<svg width=\"18\" height=\"18\" ' + 'xmlns=\"http://www.w3.org/2000/svg\">' + '<circle cx=\"8\" cy=\"8\" r=\"8\" ' + 'fill=\"#1b468d\" stroke=\"white\" stroke-width=\"1\"  />' + \"</svg>\",\n          dotIcon = new window.H.map.Icon(svgMarkup, {\n        anchor: {\n          x: 8,\n          y: 8\n        }\n      }),\n          group = new window.H.map.Group(),\n          i,\n          j; // Add a marker for each maneuver\n\n      for (i = 0; i < route.leg.length; i += 1) {\n        for (j = 0; j < route.leg[i].maneuver.length; j += 1) {\n          var maneuver = route.leg[i].maneuver[j];\n          console.log(\"maneuver: \", maneuver); // Add a marker to the maneuvers group\n\n          var marker = new window.H.map.Marker({\n            lat: maneuver.position.latitude,\n            lng: maneuver.position.longitude\n          }, {\n            icon: dotIcon\n          });\n          marker.instruction = maneuver.instruction;\n          group.addObject(marker);\n        }\n      }\n\n      group.addEventListener(\"tap\", function (evt) {\n        _this.map.setCenter(evt.target.getPosition());\n\n        _this.openBubble(evt.target.getPosition(), evt.target.instruction);\n      }, false); // Add the maneuvers group to the map\n\n      _this.map.addObject(group);\n    };\n\n    _this.openBubble = function (position, text) {\n      if (!_this.bubble) {\n        _this.bubble = new window.H.ui.InfoBubble(position, // The FO property holds the province name.\n        {\n          content: text\n        });\n\n        _this.ui.addBubble(_this.bubble);\n      } else {\n        _this.bubble.setPosition(position);\n\n        _this.bubble.setContent(text);\n\n        _this.bubble.open();\n      }\n    };\n\n    _this.render = function () {\n      var style = {\n        width: \"100%\",\n        height: \"400px\",\n        background: \"grey\"\n      };\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"here-map\",\n        style: style,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }));\n    };\n\n    _this.platform = null;\n    _this.map = null;\n    var _this$props2 = _this.props,\n        _lat = _this$props2.lat,\n        _lng = _this$props2.lng,\n        _zoom = _this$props2.zoom;\n    _this.state = {\n      app_id: here.app_id,\n      app_code: here.app_code,\n      center: {\n        lat: _lat ? _lat : 0,\n        lng: _lng ? _lng : 0\n      },\n      useCIT: true,\n      useHTTPS: true,\n      zoom: _zoom,\n      theme: _this.themes[1],\n      stores: []\n    };\n    return _this;\n  } // TODO: Add theme selection discussed later HERE\n\n\n  return Map;\n}(Component);\n\nexport default Map;","map":{"version":3,"sources":["/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/direction/Directions/Map.jsx"],"names":["React","Component","here","_","Dropdown","DropdownToggle","DropdownMenu","DropdownItem","WebService","Map","props","MAX_DIS","themes","image","componentWillMount","lat","lng","zoom","setState","center","componentDidMount","drawMap","componentWillReceiveProps","nextProps","prepareLayout","platform","window","H","service","Platform","state","pixelRatio","devicePixelRatio","layer","createDefaultLayers","tileSize","ppi","undefined","container","document","getElementById","map","normal","mapTileService","getMapTileService","type","vietnameseMapLayer","createTileLayer","lg","setBaseLayer","events","mapevents","MapEvents","behavior","Behavior","ui","UI","createDefault","parisMarker","Marker","addObject","geocode","findNearestMarker","addresses","address","item","index","geocoder","getGeocodingService","geocodingParameters","searchText","jsonattributes","result","locations","response","view","addLocationsToMap","id","error","console","log","location","group","Group","position","displayPosition","latitude","longitude","myIcon","Icon","html","label","marker","icon","setData","draggable","setCenter","getBounds","getCenter","distance","getObjects","getPosition","updateLocation","then","res","catch","err","addEventListener","evt","bubble","InfoBubble","target","content","getData","addBubble","getAllLocation","stores","JSON","parse","nearestStore","calculateRouteFromAtoB","point1","point2","router","getRoutingService","routeRequestParams","mode","representation","waypoint0","waypoint1","routeattributes","maneuverattributes","calculateRoute","route","addRouteShapeToMap","addManueversToMap","alert","strip","geo","Strip","routeShape","shape","polyline","forEach","point","parts","split","pushLatLngAlt","Polyline","style","lineWidth","strokeColor","setViewBounds","svgMarkup","dotIcon","anchor","x","y","i","j","leg","length","maneuver","instruction","openBubble","text","setPosition","setContent","open","render","width","height","background","app_id","app_code","useCIT","useHTTPS","theme"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { here } from \"../../../config/constants\";\nimport _ from \"lodash\";\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from \"reactstrap\";\nimport WebService from \"../../../services/WebService\";\n// import WebService from \"../../../services/WebService\";\nclass Map extends Component<State> {\n    map;\n    layer;\n    bubble;\n    marker;\n    platform;\n    current_location;\n    MAX_DIS = 100; // m\n    themes = [\n        \"normal.day\",\n        \"normal.day.grey\",\n        \"normal.day.transit\",\n        \"normal.night\",\n        \"normal.night.grey\",\n        \"reduced.night\",\n        \"reduced.day\",\n        \"pedestrian.day\",\n        \"pedestrian.night\"\n    ];\n    events;\n    behavior;\n    ui;\n    nearestStore;\n    image = \"https://img.icons8.com/color/48/000000/marker.png\";\n\n    constructor(props: any) {\n        super(props);\n        this.platform = null;\n        this.map = null;\n\n        const { lat, lng, zoom } = this.props;\n        this.state = {\n            app_id: here.app_id,\n            app_code: here.app_code,\n            center: {\n                lat: lat ? lat : 0,\n                lng: lng ? lng : 0\n            },\n            useCIT: true,\n            useHTTPS: true,\n            zoom: zoom,\n            theme: this.themes[1],\n            stores: []\n        };\n    }\n    // TODO: Add theme selection discussed later HERE\n    componentWillMount = () => {\n        const { lat, lng, zoom } = this.props;\n        this.setState({\n            center: {\n                lat: lat ? lat : 0,\n                lng: lng ? lng : 0\n            },\n            zoom: zoom\n        });\n    };\n\n    componentDidMount = () => {\n        this.drawMap();\n    };\n\n    componentWillReceiveProps = nextProps => {\n        this.setState({\n            center: {\n                lat: nextProps.lat,\n                lng: nextProps.lng\n            }\n        });\n        this.drawMap();\n    };\n\n    prepareLayout = () => {\n        this.platform = new window.H.service.Platform(this.state);\n        // create layer to draw map\n        var pixelRatio = window.devicePixelRatio || 1;\n        this.layer = this.platform.createDefaultLayers({\n            tileSize: pixelRatio === 1 ? 256 : 512,\n            ppi: pixelRatio === 1 ? undefined : 320\n        });\n        // get div container to where to draw\n        var container = document.getElementById(\"here-map\");\n        //crate map with layer & container created\n        this.map = new window.H.Map(container, this.layer.normal.map, {\n            center: this.state.center,\n            zoom: this.state.zoom,\n            pixelRatio: pixelRatio\n        });\n        let mapTileService = this.platform.getMapTileService({\n                type: \"base\"\n            }),\n            vietnameseMapLayer = mapTileService.createTileLayer(\"maptile\", this.themes[0], pixelRatio === 1 ? 256 : 512, \"png8\", {\n                lg: \"vie\",\n                ppi: pixelRatio === 1 ? undefined : 320\n            });\n\n        this.map.setBaseLayer(vietnameseMapLayer);\n        this.events = new window.H.mapevents.MapEvents(this.map);\n        this.behavior = new window.H.mapevents.Behavior(this.events);\n        this.ui = window.H.ui.UI.createDefault(this.map, this.layer, \"zh-CN\");\n    };\n\n    drawMap = async () => {\n        this.prepareLayout();\n        const { lat, lng } = this.state.center;\n        var parisMarker = new window.H.map.Marker({ lat: lat, lng: lng });\n        this.map.addObject(parisMarker);\n\n        await this.geocode();\n        this.findNearestMarker();\n    };\n    // map to nearest store\n    geocode = () => {\n        const addresses = this.props.address;\n        if (addresses) {\n            _.map(addresses, (item, index) => {\n                const { address } = item;\n                let geocoder = this.platform.getGeocodingService();\n                let geocodingParameters = {\n                    searchText: address,\n                    jsonattributes: 1\n                };\n                geocoder.geocode(\n                    geocodingParameters,\n                    result => {\n                        var locations = result.response.view[0].result;\n                        this.addLocationsToMap(locations[0], item.id, index);\n                    },\n                    error => {\n                        console.log(\"Error when geocode address\");\n                    }\n                );\n            });\n        }\n    };\n\n    addLocationsToMap = (location, id, index) => {\n        let group = new window.H.map.Group();\n        let position = {};\n        position = {\n            lat: location.location.displayPosition.latitude,\n            lng: location.location.displayPosition.longitude\n        };\n        var myIcon = new window.H.map.Icon(this.image);\n        const html = \"<div> Chi nhánh \" + location.location.address.label + \"</div>\";\n        this.marker = new window.H.map.Marker(position, { icon: myIcon });\n        this.marker.setData(html);\n        this.marker.draggable = true;\n\n        group.addObject(this.marker);\n        this.map.addObject(group);\n        this.map.setCenter(group.getBounds().getCenter());\n        // distance to current position\n        const distance = group\n            .getObjects()[0]\n            .getPosition()\n            .distance(this.state.center);\n\n        // update location for stores\n        WebService.updateLocation(position, distance, id)\n            .then(res => {\n                console.log(res);\n            })\n            .catch(err => {\n                console.log(err);\n            });\n        //get info of store address when click map\n        group.addEventListener(\n            \"tap\",\n            evt => {\n                var bubble = new window.H.ui.InfoBubble(evt.target.getPosition(), {\n                    content: evt.target.getData()\n                });\n                this.ui.addBubble(bubble);\n            },\n            false\n        );\n    };\n\n    findNearestMarker = () => {\n        WebService.getAllLocation()\n            .then(res => {\n                const stores = JSON.parse(res).addresses;\n                const distance = stores[0].distance;\n                this.nearestStore = stores[0];\n                _.map(stores, item => {\n                    if (item.distance < distance) this.nearestStore = item;\n                });\n                this.calculateRouteFromAtoB();\n            })\n            .catch(err => {\n                console.log(err);\n            });\n    };\n\n    calculateRouteFromAtoB = () => {\n        const position = JSON.parse(this.nearestStore.location);\n        const point1 = this.state.center.lat + \",\" + this.state.center.lng;\n        const point2 = position.lat + \",\" + position.lng;\n        console.log(point1);\n        console.log(point2);\n        var router = this.platform.getRoutingService(),\n            routeRequestParams = {\n                mode: \"fastest;car\",\n                representation: \"display\",\n                waypoint0: point1,\n                waypoint1: point2,\n                routeattributes: \"waypoints,summary,shape,legs\",\n                maneuverattributes: \"direction,action\"\n            };\n\n        router.calculateRoute(\n            routeRequestParams,\n            result => {\n                var route = result.response.route[0];\n                this.addRouteShapeToMap(route);\n                this.addManueversToMap(route);\n            },\n            err => {\n                alert(\"Ooops!\");\n            }\n        );\n    };\n    addRouteShapeToMap = route => {\n        var strip = new window.H.geo.Strip(),\n            routeShape = route.shape,\n            polyline;\n\n        routeShape.forEach(point => {\n            var parts = point.split(\",\");\n            strip.pushLatLngAlt(parts[0], parts[1]);\n        });\n\n        polyline = new window.H.map.Polyline(strip, {\n            style: {\n                lineWidth: 4,\n                strokeColor: \"rgba(0, 128, 255, 0.7)\"\n            }\n        });\n        // Add the polyline to the map\n        this.map.addObject(polyline);\n        // And zoom to its bounding rectangle\n        this.map.setViewBounds(polyline.getBounds(), true);\n    };\n\n    addManueversToMap = route => {\n        var svgMarkup =\n                '<svg width=\"18\" height=\"18\" ' +\n                'xmlns=\"http://www.w3.org/2000/svg\">' +\n                '<circle cx=\"8\" cy=\"8\" r=\"8\" ' +\n                'fill=\"#1b468d\" stroke=\"white\" stroke-width=\"1\"  />' +\n                \"</svg>\",\n            dotIcon = new window.H.map.Icon(svgMarkup, { anchor: { x: 8, y: 8 } }),\n            group = new window.H.map.Group(),\n            i,\n            j;\n\n        // Add a marker for each maneuver\n        for (i = 0; i < route.leg.length; i += 1) {\n            for (j = 0; j < route.leg[i].maneuver.length; j += 1) {\n                let maneuver = route.leg[i].maneuver[j];\n                console.log(\"maneuver: \", maneuver);\n                // Add a marker to the maneuvers group\n                var marker = new window.H.map.Marker(\n                    {\n                        lat: maneuver.position.latitude,\n                        lng: maneuver.position.longitude\n                    },\n                    { icon: dotIcon }\n                );\n                marker.instruction = maneuver.instruction;\n                group.addObject(marker);\n            }\n        }\n        group.addEventListener(\n            \"tap\",\n            evt => {\n                this.map.setCenter(evt.target.getPosition());\n                this.openBubble(evt.target.getPosition(), evt.target.instruction);\n            },\n            false\n        );\n\n        // Add the maneuvers group to the map\n        this.map.addObject(group);\n    };\n    openBubble = (position, text) => {\n        if (!this.bubble) {\n            this.bubble = new window.H.ui.InfoBubble(\n                position,\n                // The FO property holds the province name.\n                { content: text }\n            );\n            this.ui.addBubble(this.bubble);\n        } else {\n            this.bubble.setPosition(position);\n            this.bubble.setContent(text);\n            this.bubble.open();\n        }\n    };\n\n    render = () => {\n        const style = {\n            width: \"100%\",\n            height: \"400px\",\n            background: \"grey\"\n        };\n        return (\n            <div>\n                <div id=\"here-map\" style={style} />\n            </div>\n        );\n    };\n}\nexport default Map;\n"]},"metadata":{},"sourceType":"module"}