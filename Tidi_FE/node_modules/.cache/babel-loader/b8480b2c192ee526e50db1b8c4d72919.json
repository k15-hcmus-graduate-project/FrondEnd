{"ast":null,"code":"import _regeneratorRuntime from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/products/ProductDetail/ProductDetail.jsx\";\n// StyleSheets\nimport React, { Component } from \"react\";\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { FacebookProvider, Comments } from \"react-facebook\";\nimport \"./ProductDetail.scss\";\nimport WebService from \"../../../services/WebService\";\nimport AuthService from \"../../../services/AuthService\";\nimport { showAlert } from \"../../../helpers/lib\";\nimport { withCommas } from \"../../../helpers/lib\";\nimport Loader from \"../../common/Loader/Loader\";\nimport parseConfig from \"../../../helpers/parse\";\nvar Parse = parseConfig.Parse;\nvar client = parseConfig.LiveQueryClient;\nvar INTITIAL_STATE = {\n  product: null,\n  productFound: false\n};\n\nvar ProductDetail =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ProductDetail, _Component);\n\n  function ProductDetail(props) {\n    var _this;\n\n    _classCallCheck(this, ProductDetail);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProductDetail).call(this, props));\n\n    _this.componentWillMount = function () {\n      _this.fetchProduct();\n    };\n\n    _this.componentWillUpdate = function (nextProps) {\n      if (nextProps.match.params.id !== _this.props.match.params.id) {\n        _this.fetchProduct();\n      }\n    };\n\n    _this.doSomethingBeforeUnload = function () {\n      WebService.descViewer(_this.state.product.id).then(function (res) {\n        console.log(\"descrease viewer by one\");\n      });\n    };\n\n    _this.setupBeforeUnloadListener = function () {\n      window.addEventListener(\"beforeunload\", function (ev) {\n        console.log(\"close windows\");\n        ev.preventDefault();\n        return _this.doSomethingBeforeUnload();\n      });\n    };\n\n    _this.componentDidMount = function () {\n      var subscription = client.subscribe(parseQuery);\n      subscription.on(\"update\",\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(object) {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return object.get(\"amount\");\n\n                case 2:\n                  row.amount = _context.sent;\n                  _context.next = 5;\n                  return object.get(\"viewer\");\n\n                case 5:\n                  row.viewer = _context.sent;\n                  console.log(\"Amount updated: \" + row.amount);\n                  console.log(\"Viewers: \" + row.viewer);\n                  console.log(\"return json result\"); // res.json(row);\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()); // Activate the event listener\n\n      _this.setupBeforeUnloadListener();\n    };\n\n    _this.componentWillUnmount = function () {\n      console.log(\"da roi khoi trang\");\n      console.log(_this.state.product);\n      WebService.descViewer(_this.state.product.id).then(function (res) {\n        console.log(\"descrease viewer by one\");\n      });\n    };\n\n    _this.fetchProduct = function () {\n      var productId = Number(_this.props.match.params.id);\n\n      if (!isNaN(productId) && productId > 0) {\n        WebService.getProduct(productId).then(function (res) {\n          var product = JSON.parse(res);\n          console.log(product);\n\n          if (product.status !== 500) {\n            product.images = JSON.parse(product.images);\n\n            _this.setState({\n              product: product,\n              productFound: true\n            });\n          } else {\n            console.log(product);\n          }\n        });\n      }\n    };\n\n    _this.fetchCartProducts = function () {\n      var isLoggedIn = _this.props.isLoggedIn;\n\n      if (isLoggedIn) {\n        WebService.getCart(AuthService.getTokenUnsafe()).then(function (res) {\n          var result = JSON.parse(res);\n\n          if (result.status.status === \"TRUE\") {\n            if (result.products) {\n              result.products.forEach(function (prd) {\n                return prd.images = JSON.parse(prd.images);\n              });\n            }\n\n            _this.props.updateCartProducts(result.products);\n          }\n        });\n      }\n    };\n\n    _this.handleAddProductToCart = function (product) {\n      var _this$props = _this.props,\n          isLoggedIn = _this$props.isLoggedIn,\n          cart = _this$props.cart;\n\n      if (isLoggedIn) {\n        var currentCartItems = cart.products;\n\n        if (product.id) {\n          var cartItemAmount = 0;\n\n          if (currentCartItems) {\n            //  no-unused-vars\n            _.map(currentCartItems, function (cartItem) {\n              if (cartItem.id === product.id) {\n                cartItemAmount = cartItem.amount;\n              }\n            });\n          }\n\n          cartItemAmount += 1;\n          WebService.addItemToCart(AuthService.getTokenUnsafe(), product.id, cartItemAmount).then(function (r) {\n            var res = JSON.parse(r);\n\n            if (res.status) {\n              showAlert(\"Added \".concat(product.productName, \" to Cart!\"));\n\n              _this.fetchCartProducts();\n            }\n          });\n        }\n      } else {\n        showAlert(\"You have not logged in yet\", \"error\");\n      }\n    };\n\n    _this.generatePictures = function () {\n      var r = [];\n      var images = _this.state.product.images;\n\n      if (images) {\n        images.forEach(function (imageURL, index) {\n          r.push(React.createElement(\"div\", {\n            key: index,\n            className: \"carousel-item\" + (index === 0 ? \" active\" : \"\"),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 150\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            className: \"d-block w-100\",\n            src: imageURL,\n            alt: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 151\n            },\n            __self: this\n          })));\n        });\n      }\n\n      return r;\n    };\n\n    _this.render = function () {\n      var _this$state = _this.state,\n          productFound = _this$state.productFound,\n          product = _this$state.product;\n\n      if (!productFound) {\n        return React.createElement(\"div\", {\n          className: \"d-flex justify-content-center p-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163\n          },\n          __self: this\n        }, \"Product not found\");\n      } else if (Object.keys(product).length === 0) {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        });\n      } else {\n        var discountedPercent = Math.round(product.discPercent * 100);\n        var discountedPrice = Math.round(product.price - product.price * product.discPercent);\n        var listdescription = product.description.split(\"\\n\");\n        var listDescription = [];\n\n        for (var j = 0; j < listdescription.length; j++) {\n          listDescription[j] = React.createElement(\"p\", {\n            key: j,\n            className: \"product-desc\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 173\n            },\n            __self: this\n          }, listdescription[j]);\n        }\n\n        return React.createElement(\"div\", {\n          className: \"single_product_details_area d-flex align-items-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        }, !_this.state.product && React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          id: \"images-slider\",\n          className: \"single_product_thumb carousel slide\",\n          \"data-ride\": \"carousel\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"carousel-inner\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, _this.generatePictures()), React.createElement(\"a\", {\n          className: \"carousel-control-prev owl-prev\",\n          href: \"#images-slider\",\n          role: \"button\",\n          \"data-slide\": \"prev\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"fa fa-chevron-circle-left fa-5x\",\n          \"aria-hidden\": \"false\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"sr-only\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }, \"Previous\")), React.createElement(\"a\", {\n          className: \"carousel-control-next owl-next\",\n          href: \"#images-slider\",\n          role: \"button\",\n          \"data-slide\": \"next\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"fa fa-chevron-circle-right fa-5x\",\n          \"aria-hidden\": \"false\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"sr-only\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }, \"Next\"))), React.createElement(\"div\", {\n          className: \"single_product_desc clearfix\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }, product.brand && product.brand[0].brand_name), React.createElement(\"a\", {\n          href: \"cart.html\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, React.createElement(\"h2\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }, product.product_name)), React.createElement(\"p\", {\n          className: \"product-price\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199\n          },\n          __self: this\n        }, product.discPercent !== 0 && React.createElement(\"span\", {\n          className: \"old-price\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }, withCommas(product.price) + \" ₫\"), withCommas(discountedPrice) + \" ₫  \", discountedPercent ? \"(-\" + discountedPercent + \"%)\" : null), React.createElement(\"h4\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        }, listDescription), React.createElement(\"form\", {\n          className: \"cart-form clearfix\",\n          method: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 206\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"cart-fav-box d-flex align-items-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 208\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          type: \"button\",\n          name: \"addtocart\",\n          className: \"btn essence-btn\",\n          onClick: function onClick() {\n            return _this.handleAddProductToCart(product);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, \"Add to cart\"), React.createElement(\"div\", {\n          className: \"product-favourite ml-4\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"#/\",\n          className: \"favme fa fa-heart\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 221\n          },\n          __self: this\n        })))), React.createElement(\"div\", {\n          className: \"cart-fav-box d-flex align-items-center justify-content-end\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 226\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 227\n          },\n          __self: this\n        }, product.category && product.category[0].category_name)))), React.createElement(\"div\", {\n          className: \"full-description-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 233\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234\n          },\n          __self: this\n        }, product.description)), React.createElement(\"div\", {\n          className: \"fb-comment-plugin-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 237\n          },\n          __self: this\n        }, React.createElement(FacebookProvider, {\n          appId: \"486326855227569\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238\n          },\n          __self: this\n        }, React.createElement(Comments, {\n          href: \"https://tidi-binpossible49.c9users.io\" + _this.props.location.pathname,\n          className: \"kdjf\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239\n          },\n          __self: this\n        }))));\n      }\n    };\n\n    _this.state = INTITIAL_STATE;\n    return _this;\n  }\n\n  return ProductDetail;\n}(Component);\n\nProductDetail.propTypes = {\n  isLoggedIn: PropTypes.bool,\n  updateCartProducts: PropTypes.func,\n  cart: PropTypes.shape({\n    products: PropTypes.array\n  })\n};\nexport default ProductDetail;","map":{"version":3,"sources":["/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/products/ProductDetail/ProductDetail.jsx"],"names":["React","Component","_","PropTypes","FacebookProvider","Comments","WebService","AuthService","showAlert","withCommas","Loader","parseConfig","Parse","client","LiveQueryClient","INTITIAL_STATE","product","productFound","ProductDetail","props","componentWillMount","fetchProduct","componentWillUpdate","nextProps","match","params","id","doSomethingBeforeUnload","descViewer","state","then","res","console","log","setupBeforeUnloadListener","window","addEventListener","ev","preventDefault","componentDidMount","subscription","subscribe","parseQuery","on","object","get","row","amount","viewer","componentWillUnmount","productId","Number","isNaN","getProduct","JSON","parse","status","images","setState","fetchCartProducts","isLoggedIn","getCart","getTokenUnsafe","result","products","forEach","prd","updateCartProducts","handleAddProductToCart","cart","currentCartItems","cartItemAmount","map","cartItem","addItemToCart","r","productName","generatePictures","imageURL","index","push","render","Object","keys","length","discountedPercent","Math","round","discPercent","discountedPrice","price","listdescription","description","split","listDescription","j","brand","brand_name","product_name","category","category_name","location","pathname","propTypes","bool","func","shape","array"],"mappings":";;;;;;;AAAA;AACA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,gBAAT,EAA2BC,QAA3B,QAA2C,gBAA3C;AACA,OAAO,sBAAP;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,SAASC,SAAT,QAA0B,sBAA1B;AACA,SAASC,UAAT,QAA2B,sBAA3B;AACA,OAAOC,MAAP,MAAmB,4BAAnB;AAEA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,IAAMC,KAAK,GAAGD,WAAW,CAACC,KAA1B;AACA,IAAMC,MAAM,GAAGF,WAAW,CAACG,eAA3B;AAEA,IAAMC,cAAc,GAAG;AACnBC,EAAAA,OAAO,EAAE,IADU;AAEnBC,EAAAA,YAAY,EAAE;AAFK,CAAvB;;IAKMC,a;;;;;AASF,yBAAYC,KAAZ,EAAwB;AAAA;;AAAA;;AACpB,uFAAMA,KAAN;;AADoB,UAKxBC,kBALwB,GAKH,YAAM;AACvB,YAAKC,YAAL;AACH,KAPuB;;AAAA,UASxBC,mBATwB,GASF,UAAAC,SAAS,EAAI;AAC/B,UAAIA,SAAS,CAACC,KAAV,CAAgBC,MAAhB,CAAuBC,EAAvB,KAA8B,MAAKP,KAAL,CAAWK,KAAX,CAAiBC,MAAjB,CAAwBC,EAA1D,EAA8D;AAC1D,cAAKL,YAAL;AACH;AACJ,KAbuB;;AAAA,UAexBM,uBAfwB,GAeE,YAAM;AAC5BrB,MAAAA,UAAU,CAACsB,UAAX,CAAsB,MAAKC,KAAL,CAAWb,OAAX,CAAmBU,EAAzC,EAA6CI,IAA7C,CAAkD,UAAAC,GAAG,EAAI;AACrDC,QAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AACH,OAFD;AAGH,KAnBuB;;AAAA,UAsBxBC,yBAtBwB,GAsBI,YAAM;AAC9BC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,cAAxB,EAAwC,UAAAC,EAAE,EAAI;AAC1CL,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAI,QAAAA,EAAE,CAACC,cAAH;AACA,eAAO,MAAKX,uBAAL,EAAP;AACH,OAJD;AAKH,KA5BuB;;AAAA,UA8BxBY,iBA9BwB,GA8BJ,YAAM;AACtB,UAAMC,YAAY,GAAG3B,MAAM,CAAC4B,SAAP,CAAiBC,UAAjB,CAArB;AAEAF,MAAAA,YAAY,CAACG,EAAb,CAAgB,QAAhB;AAAA;AAAA;AAAA;AAAA;AAAA,iCAA0B,iBAAMC,MAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACHA,MAAM,CAACC,GAAP,CAAW,QAAX,CADG;;AAAA;AACtBC,kBAAAA,GAAG,CAACC,MADkB;AAAA;AAAA,yBAEHH,MAAM,CAACC,GAAP,CAAW,QAAX,CAFG;;AAAA;AAEtBC,kBAAAA,GAAG,CAACE,MAFkB;AAGtBhB,kBAAAA,OAAO,CAACC,GAAR,CAAY,qBAAqBa,GAAG,CAACC,MAArC;AACAf,kBAAAA,OAAO,CAACC,GAAR,CAAY,cAAca,GAAG,CAACE,MAA9B;AACAhB,kBAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EALsB,CAMtB;;AANsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA1B;;AAAA;AAAA;AAAA;AAAA,WAHsB,CAWtB;;AACA,YAAKC,yBAAL;AACH,KA3CuB;;AAAA,UA4CxBe,oBA5CwB,GA4CD,YAAM;AACzBjB,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAKJ,KAAL,CAAWb,OAAvB;AACAV,MAAAA,UAAU,CAACsB,UAAX,CAAsB,MAAKC,KAAL,CAAWb,OAAX,CAAmBU,EAAzC,EAA6CI,IAA7C,CAAkD,UAAAC,GAAG,EAAI;AACrDC,QAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AACH,OAFD;AAGH,KAlDuB;;AAAA,UAmDxBZ,YAnDwB,GAmDT,YAAM;AACjB,UAAM6B,SAAS,GAAGC,MAAM,CAAC,MAAKhC,KAAL,CAAWK,KAAX,CAAiBC,MAAjB,CAAwBC,EAAzB,CAAxB;;AACA,UAAI,CAAC0B,KAAK,CAACF,SAAD,CAAN,IAAqBA,SAAS,GAAG,CAArC,EAAwC;AACpC5C,QAAAA,UAAU,CAAC+C,UAAX,CAAsBH,SAAtB,EAAiCpB,IAAjC,CAAsC,UAAAC,GAAG,EAAI;AACzC,cAAMf,OAAO,GAAGsC,IAAI,CAACC,KAAL,CAAWxB,GAAX,CAAhB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYjB,OAAZ;;AACA,cAAIA,OAAO,CAACwC,MAAR,KAAmB,GAAvB,EAA4B;AACxBxC,YAAAA,OAAO,CAACyC,MAAR,GAAiBH,IAAI,CAACC,KAAL,CAAWvC,OAAO,CAACyC,MAAnB,CAAjB;;AACA,kBAAKC,QAAL,CAAc;AACV1C,cAAAA,OAAO,EAAPA,OADU;AAEVC,cAAAA,YAAY,EAAE;AAFJ,aAAd;AAIH,WAND,MAMO;AACHe,YAAAA,OAAO,CAACC,GAAR,CAAYjB,OAAZ;AACH;AACJ,SAZD;AAaH;AACJ,KApEuB;;AAAA,UAsExB2C,iBAtEwB,GAsEJ,YAAM;AAAA,UACdC,UADc,GACC,MAAKzC,KADN,CACdyC,UADc;;AAEtB,UAAIA,UAAJ,EAAgB;AACZtD,QAAAA,UAAU,CAACuD,OAAX,CAAmBtD,WAAW,CAACuD,cAAZ,EAAnB,EAAiDhC,IAAjD,CAAsD,UAAAC,GAAG,EAAI;AACzD,cAAMgC,MAAM,GAAGT,IAAI,CAACC,KAAL,CAAWxB,GAAX,CAAf;;AACA,cAAIgC,MAAM,CAACP,MAAP,CAAcA,MAAd,KAAyB,MAA7B,EAAqC;AACjC,gBAAIO,MAAM,CAACC,QAAX,EAAqB;AACjBD,cAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,UAAAC,GAAG;AAAA,uBAAKA,GAAG,CAACT,MAAJ,GAAaH,IAAI,CAACC,KAAL,CAAWW,GAAG,CAACT,MAAf,CAAlB;AAAA,eAA3B;AACH;;AACD,kBAAKtC,KAAL,CAAWgD,kBAAX,CAA8BJ,MAAM,CAACC,QAArC;AACH;AACJ,SARD;AASH;AACJ,KAnFuB;;AAAA,UAqFxBI,sBArFwB,GAqFC,UAACpD,OAAD,EAAkB;AAAA,wBACV,MAAKG,KADK;AAAA,UAC/ByC,UAD+B,eAC/BA,UAD+B;AAAA,UACnBS,IADmB,eACnBA,IADmB;;AAEvC,UAAIT,UAAJ,EAAgB;AACZ,YAAMU,gBAAgB,GAAGD,IAAI,CAACL,QAA9B;;AACA,YAAIhD,OAAO,CAACU,EAAZ,EAAgB;AACZ,cAAI6C,cAAc,GAAG,CAArB;;AACA,cAAID,gBAAJ,EAAsB;AAClB;AACApE,YAAAA,CAAC,CAACsE,GAAF,CAAMF,gBAAN,EAAwB,UAAAG,QAAQ,EAAI;AAChC,kBAAIA,QAAQ,CAAC/C,EAAT,KAAgBV,OAAO,CAACU,EAA5B,EAAgC;AAC5B6C,gBAAAA,cAAc,GAAGE,QAAQ,CAAC1B,MAA1B;AACH;AACJ,aAJD;AAKH;;AACDwB,UAAAA,cAAc,IAAI,CAAlB;AACAjE,UAAAA,UAAU,CAACoE,aAAX,CAAyBnE,WAAW,CAACuD,cAAZ,EAAzB,EAAuD9C,OAAO,CAACU,EAA/D,EAAmE6C,cAAnE,EAAmFzC,IAAnF,CAAwF,UAAA6C,CAAC,EAAI;AACzF,gBAAM5C,GAAG,GAAGuB,IAAI,CAACC,KAAL,CAAWoB,CAAX,CAAZ;;AACA,gBAAI5C,GAAG,CAACyB,MAAR,EAAgB;AACZhD,cAAAA,SAAS,iBAAUQ,OAAO,CAAC4D,WAAlB,eAAT;;AACA,oBAAKjB,iBAAL;AACH;AACJ,WAND;AAOH;AACJ,OArBD,MAqBO;AACHnD,QAAAA,SAAS,CAAC,4BAAD,EAA+B,OAA/B,CAAT;AACH;AACJ,KA/GuB;;AAAA,UAiHxBqE,gBAjHwB,GAiHL,YAAM;AACrB,UAAIF,CAAC,GAAG,EAAR;AADqB,UAEblB,MAFa,GAEF,MAAK5B,KAAL,CAAWb,OAFT,CAEbyC,MAFa;;AAGrB,UAAIA,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAACQ,OAAP,CAAe,UAACa,QAAD,EAAWC,KAAX,EAAqB;AAChCJ,UAAAA,CAAC,CAACK,IAAF,CACI;AAAK,YAAA,GAAG,EAAED,KAAV;AAAiB,YAAA,SAAS,EAAE,mBAAmBA,KAAK,KAAK,CAAV,GAAc,SAAd,GAA0B,EAA7C,CAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI;AAAK,YAAA,SAAS,EAAC,eAAf;AAA+B,YAAA,GAAG,EAAED,QAApC;AAA8C,YAAA,GAAG,EAAC,EAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ,CADJ;AAKH,SAND;AAOH;;AAED,aAAOH,CAAP;AACH,KA/HuB;;AAAA,UAiIxBM,MAjIwB,GAiIf,YAAM;AAAA,wBACuB,MAAKpD,KAD5B;AAAA,UACHZ,YADG,eACHA,YADG;AAAA,UACWD,OADX,eACWA,OADX;;AAEX,UAAI,CAACC,YAAL,EAAmB;AACf,eAAO;AAAK,UAAA,SAAS,EAAC,mCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAP;AACH,OAFD,MAEO,IAAIiE,MAAM,CAACC,IAAP,CAAYnE,OAAZ,EAAqBoE,MAArB,KAAgC,CAApC,EAAuC;AAC1C,eAAO,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACH,OAFM,MAEA;AACH,YAAMC,iBAAiB,GAAGC,IAAI,CAACC,KAAL,CAAWvE,OAAO,CAACwE,WAAR,GAAsB,GAAjC,CAA1B;AACA,YAAMC,eAAe,GAAGH,IAAI,CAACC,KAAL,CAAWvE,OAAO,CAAC0E,KAAR,GAAgB1E,OAAO,CAAC0E,KAAR,GAAgB1E,OAAO,CAACwE,WAAnD,CAAxB;AACA,YAAMG,eAAe,GAAG3E,OAAO,CAAC4E,WAAR,CAAoBC,KAApB,CAA0B,IAA1B,CAAxB;AACA,YAAMC,eAAe,GAAG,EAAxB;;AACA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,eAAe,CAACP,MAApC,EAA4CW,CAAC,EAA7C,EAAiD;AAC7CD,UAAAA,eAAe,CAACC,CAAD,CAAf,GACI;AAAG,YAAA,GAAG,EAAEA,CAAR;AAAW,YAAA,SAAS,EAAC,cAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACKJ,eAAe,CAACI,CAAD,CADpB,CADJ;AAKH;;AACD,eACI;AAAK,UAAA,SAAS,EAAC,uDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACK,CAAC,MAAKlE,KAAL,CAAWb,OAAZ,IAAuB,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAD5B,EAEI;AAAK,UAAA,EAAE,EAAC,eAAR;AAAwB,UAAA,SAAS,EAAC,qCAAlC;AAAwE,uBAAU,UAAlF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAK,UAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAiC,MAAK6D,gBAAL,EAAjC,CADJ,EAEI;AAAG,UAAA,SAAS,EAAC,gCAAb;AAA8C,UAAA,IAAI,EAAC,gBAAnD;AAAoE,UAAA,IAAI,EAAC,QAAzE;AAAkF,wBAAW,MAA7F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAM,UAAA,SAAS,EAAC,iCAAhB;AAAkD,yBAAY,OAA9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ,EAEI;AAAM,UAAA,SAAS,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFJ,CAFJ,EAMI;AAAG,UAAA,SAAS,EAAC,gCAAb;AAA8C,UAAA,IAAI,EAAC,gBAAnD;AAAoE,UAAA,IAAI,EAAC,QAAzE;AAAkF,wBAAW,MAA7F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAM,UAAA,SAAS,EAAC,kCAAhB;AAAmD,yBAAY,OAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ,EAEI;AAAM,UAAA,SAAS,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ,CANJ,CAFJ,EAeI;AAAK,UAAA,SAAS,EAAC,8BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAO7D,OAAO,CAACgF,KAAR,IAAiBhF,OAAO,CAACgF,KAAR,CAAc,CAAd,EAAiBC,UAAzC,CADJ,EAEI;AAAG,UAAA,IAAI,EAAC,WAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAKjF,OAAO,CAACkF,YAAb,CADJ,CAFJ,EAKI;AAAG,UAAA,SAAS,EAAC,eAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACKlF,OAAO,CAACwE,WAAR,KAAwB,CAAxB,IAA6B;AAAM,UAAA,SAAS,EAAC,WAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAA6B/E,UAAU,CAACO,OAAO,CAAC0E,KAAT,CAAV,GAA4B,IAAzD,CADlC,EAEKjF,UAAU,CAACgF,eAAD,CAAV,GAA8B,MAFnC,EAGKJ,iBAAiB,GAAG,OAAOA,iBAAP,GAA2B,IAA9B,GAAqC,IAH3D,CALJ,EAUI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAKS,eAAL,CAVJ,EAYI;AAAM,UAAA,SAAS,EAAC,oBAAhB;AAAqC,UAAA,MAAM,EAAC,MAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAEI;AAAK,UAAA,SAAS,EAAC,wCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAEI;AACI,UAAA,IAAI,EAAC,QADT;AAEI,UAAA,IAAI,EAAC,WAFT;AAGI,UAAA,SAAS,EAAC,iBAHd;AAII,UAAA,OAAO,EAAE;AAAA,mBAAM,MAAK1B,sBAAL,CAA4BpD,OAA5B,CAAN;AAAA,WAJb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAFJ,EAWI;AAAK,UAAA,SAAS,EAAC,wBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAG,UAAA,IAAI,EAAC,IAAR;AAAa,UAAA,SAAS,EAAC,mBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ,CADJ,CAXJ,CAFJ,EAoBI;AAAK,UAAA,SAAS,EAAC,4DAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAG,UAAA,IAAI,EAAC,GAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAaA,OAAO,CAACmF,QAAR,IAAoBnF,OAAO,CAACmF,QAAR,CAAiB,CAAjB,EAAoBC,aAArD,CADJ,CApBJ,CAZJ,CAfJ,EAsDI;AAAK,UAAA,SAAS,EAAC,4BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAK,UAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAA4BpF,OAAO,CAAC4E,WAApC,CADJ,CAtDJ,EA0DI;AAAK,UAAA,SAAS,EAAC,6BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI,oBAAC,gBAAD;AAAkB,UAAA,KAAK,EAAC,iBAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI,oBAAC,QAAD;AAAU,UAAA,IAAI,EAAE,0CAA0C,MAAKzE,KAAL,CAAWkF,QAAX,CAAoBC,QAA9E;AAAwF,UAAA,SAAS,EAAC,MAAlG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ,CADJ,CA1DJ,CADJ;AAkEH;AACJ,KAtNuB;;AAEpB,UAAKzE,KAAL,GAAad,cAAb;AAFoB;AAGvB;;;EAZuBd,S;;AAAtBiB,a,CACKqF,S,GAAY;AACf3C,EAAAA,UAAU,EAAEzD,SAAS,CAACqG,IADP;AAEfrC,EAAAA,kBAAkB,EAAEhE,SAAS,CAACsG,IAFf;AAGfpC,EAAAA,IAAI,EAAElE,SAAS,CAACuG,KAAV,CAAgB;AAClB1C,IAAAA,QAAQ,EAAE7D,SAAS,CAACwG;AADF,GAAhB;AAHS,C;AAiOvB,eAAezF,aAAf","sourcesContent":["// StyleSheets\nimport React, { Component } from \"react\";\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { FacebookProvider, Comments } from \"react-facebook\";\nimport \"./ProductDetail.scss\";\nimport WebService from \"../../../services/WebService\";\nimport AuthService from \"../../../services/AuthService\";\nimport { showAlert } from \"../../../helpers/lib\";\nimport { withCommas } from \"../../../helpers/lib\";\nimport Loader from \"../../common/Loader/Loader\";\n\nimport parseConfig from \"../../../helpers/parse\";\nconst Parse = parseConfig.Parse;\nconst client = parseConfig.LiveQueryClient;\n\nconst INTITIAL_STATE = {\n    product: null,\n    productFound: false\n};\n\nclass ProductDetail extends Component {\n    static propTypes = {\n        isLoggedIn: PropTypes.bool,\n        updateCartProducts: PropTypes.func,\n        cart: PropTypes.shape({\n            products: PropTypes.array\n        })\n    };\n\n    constructor(props: any) {\n        super(props);\n        this.state = INTITIAL_STATE;\n    }\n\n    componentWillMount = () => {\n        this.fetchProduct();\n    };\n\n    componentWillUpdate = nextProps => {\n        if (nextProps.match.params.id !== this.props.match.params.id) {\n            this.fetchProduct();\n        }\n    };\n\n    doSomethingBeforeUnload = () => {\n        WebService.descViewer(this.state.product.id).then(res => {\n            console.log(\"descrease viewer by one\");\n        });\n    };\n\n    // Setup the `beforeunload` event listener\n    setupBeforeUnloadListener = () => {\n        window.addEventListener(\"beforeunload\", ev => {\n            console.log(\"close windows\");\n            ev.preventDefault();\n            return this.doSomethingBeforeUnload();\n        });\n    };\n\n    componentDidMount = () => {\n        const subscription = client.subscribe(parseQuery);\n\n        subscription.on(\"update\", async object => {\n            row.amount = await object.get(\"amount\");\n            row.viewer = await object.get(\"viewer\");\n            console.log(\"Amount updated: \" + row.amount);\n            console.log(\"Viewers: \" + row.viewer);\n            console.log(\"return json result\");\n            // res.json(row);\n        });\n        // Activate the event listener\n        this.setupBeforeUnloadListener();\n    };\n    componentWillUnmount = () => {\n        console.log(\"da roi khoi trang\");\n        console.log(this.state.product);\n        WebService.descViewer(this.state.product.id).then(res => {\n            console.log(\"descrease viewer by one\");\n        });\n    };\n    fetchProduct = () => {\n        const productId = Number(this.props.match.params.id);\n        if (!isNaN(productId) && productId > 0) {\n            WebService.getProduct(productId).then(res => {\n                const product = JSON.parse(res);\n                console.log(product);\n                if (product.status !== 500) {\n                    product.images = JSON.parse(product.images);\n                    this.setState({\n                        product,\n                        productFound: true\n                    });\n                } else {\n                    console.log(product);\n                }\n            });\n        }\n    };\n\n    fetchCartProducts = () => {\n        const { isLoggedIn } = this.props;\n        if (isLoggedIn) {\n            WebService.getCart(AuthService.getTokenUnsafe()).then(res => {\n                const result = JSON.parse(res);\n                if (result.status.status === \"TRUE\") {\n                    if (result.products) {\n                        result.products.forEach(prd => (prd.images = JSON.parse(prd.images)));\n                    }\n                    this.props.updateCartProducts(result.products);\n                }\n            });\n        }\n    };\n\n    handleAddProductToCart = (product: any) => {\n        const { isLoggedIn, cart } = this.props;\n        if (isLoggedIn) {\n            const currentCartItems = cart.products;\n            if (product.id) {\n                let cartItemAmount = 0;\n                if (currentCartItems) {\n                    //  no-unused-vars\n                    _.map(currentCartItems, cartItem => {\n                        if (cartItem.id === product.id) {\n                            cartItemAmount = cartItem.amount;\n                        }\n                    });\n                }\n                cartItemAmount += 1;\n                WebService.addItemToCart(AuthService.getTokenUnsafe(), product.id, cartItemAmount).then(r => {\n                    const res = JSON.parse(r);\n                    if (res.status) {\n                        showAlert(`Added ${product.productName} to Cart!`);\n                        this.fetchCartProducts();\n                    }\n                });\n            }\n        } else {\n            showAlert(\"You have not logged in yet\", \"error\");\n        }\n    };\n\n    generatePictures = () => {\n        let r = [];\n        const { images } = this.state.product;\n        if (images) {\n            images.forEach((imageURL, index) => {\n                r.push(\n                    <div key={index} className={\"carousel-item\" + (index === 0 ? \" active\" : \"\")}>\n                        <img className=\"d-block w-100\" src={imageURL} alt=\"\" />\n                    </div>\n                );\n            });\n        }\n\n        return r;\n    };\n\n    render = () => {\n        const { productFound, product } = this.state;\n        if (!productFound) {\n            return <div className=\"d-flex justify-content-center p-5\">Product not found</div>;\n        } else if (Object.keys(product).length === 0) {\n            return <Loader />;\n        } else {\n            const discountedPercent = Math.round(product.discPercent * 100);\n            const discountedPrice = Math.round(product.price - product.price * product.discPercent);\n            const listdescription = product.description.split(\"\\n\");\n            const listDescription = [];\n            for (var j = 0; j < listdescription.length; j++) {\n                listDescription[j] = (\n                    <p key={j} className=\"product-desc\">\n                        {listdescription[j]}\n                    </p>\n                );\n            }\n            return (\n                <div className=\"single_product_details_area d-flex align-items-center\">\n                    {!this.state.product && <Loader />}\n                    <div id=\"images-slider\" className=\"single_product_thumb carousel slide\" data-ride=\"carousel\">\n                        <div className=\"carousel-inner\">{this.generatePictures()}</div>\n                        <a className=\"carousel-control-prev owl-prev\" href=\"#images-slider\" role=\"button\" data-slide=\"prev\">\n                            <span className=\"fa fa-chevron-circle-left fa-5x\" aria-hidden=\"false\" />\n                            <span className=\"sr-only\">Previous</span>\n                        </a>\n                        <a className=\"carousel-control-next owl-next\" href=\"#images-slider\" role=\"button\" data-slide=\"next\">\n                            <span className=\"fa fa-chevron-circle-right fa-5x\" aria-hidden=\"false\" />\n                            <span className=\"sr-only\">Next</span>\n                        </a>\n                    </div>\n\n                    {/* <!-- Single Product Description --> */}\n                    <div className=\"single_product_desc clearfix\">\n                        <span>{product.brand && product.brand[0].brand_name}</span>\n                        <a href=\"cart.html\">\n                            <h2>{product.product_name}</h2>\n                        </a>\n                        <p className=\"product-price\">\n                            {product.discPercent !== 0 && <span className=\"old-price\">{withCommas(product.price) + \" ₫\"}</span>}\n                            {withCommas(discountedPrice) + \" ₫  \"}\n                            {discountedPercent ? \"(-\" + discountedPercent + \"%)\" : null}\n                        </p>\n                        <h4>{listDescription}</h4>\n                        {/* <!-- Form --> */}\n                        <form className=\"cart-form clearfix\" method=\"post\">\n                            {/* <!-- Cart & Favourite Box --> */}\n                            <div className=\"cart-fav-box d-flex align-items-center\">\n                                {/* <!-- Cart --> */}\n                                <button\n                                    type=\"button\"\n                                    name=\"addtocart\"\n                                    className=\"btn essence-btn\"\n                                    onClick={() => this.handleAddProductToCart(product)}\n                                >\n                                    Add to cart\n                                </button>\n                                {/* <!-- Favourite --> */}\n                                <div className=\"product-favourite ml-4\">\n                                    <a href=\"#/\" className=\"favme fa fa-heart\">\n                                        <span />\n                                    </a>\n                                </div>\n                            </div>\n\n                            <div className=\"cart-fav-box d-flex align-items-center justify-content-end\">\n                                <a href=\"/\">{product.category && product.category[0].category_name}</a>\n                            </div>\n                        </form>\n                    </div>\n\n                    {/* PRODUCT FULL DESCRIPTION */}\n                    <div className=\"full-description-container\">\n                        <div className=\"container\">{product.description}</div>\n                    </div>\n\n                    <div className=\"fb-comment-plugin-container\">\n                        <FacebookProvider appId=\"486326855227569\">\n                            <Comments href={\"https://tidi-binpossible49.c9users.io\" + this.props.location.pathname} className=\"kdjf\" />\n                        </FacebookProvider>\n                    </div>\n                </div>\n            );\n        }\n    };\n}\n\nexport default ProductDetail;\n"]},"metadata":{},"sourceType":"module"}