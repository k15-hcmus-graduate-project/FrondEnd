{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _toConsumableArray = require(\"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _slicedToArray = require(\"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _asyncToGenerator = require(\"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _CoreManager = _interopRequireDefault(require(\"./CoreManager\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * Copyright (c) 2015-present, Parse, LLC.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @flow\n */\n\n/**\n * Provides a local datastore which can be used to store and retrieve <code>Parse.Object</code>. <br />\n * To enable this functionality, call <code>Parse.enableLocalDatastore()</code>.\n *\n * Pin object to add to local datastore\n *\n * <pre>await object.pin();</pre>\n * <pre>await object.pinWithName('pinName');</pre>\n *\n * Query pinned objects\n *\n * <pre>query.fromLocalDatastore();</pre>\n * <pre>query.fromPin();</pre>\n * <pre>query.fromPinWithName();</pre>\n *\n * <pre>const localObjects = await query.find();</pre>\n *\n * @class Parse.LocalDatastore\n * @static\n */\n\n\nvar LocalDatastore = {\n  fromPinWithName: function fromPinWithName(name\n  /*: string*/\n  )\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.fromPinWithName(name);\n  },\n  pinWithName: function pinWithName(name\n  /*: string*/\n  , value\n  /*: any*/\n  )\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.pinWithName(name, value);\n  },\n  unPinWithName: function unPinWithName(name\n  /*: string*/\n  )\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.unPinWithName(name);\n  },\n  _getAllContents: function _getAllContents()\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getAllContents();\n  },\n  // Use for testing\n  _getRawStorage: function _getRawStorage()\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getRawStorage();\n  },\n  _clear: function _clear()\n  /*: Promise*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.clear();\n  },\n  // Pin the object and children recursively\n  // Saves the object and children key to Pin Name\n  _handlePinAllWithName: function () {\n    var _handlePinAllWithName2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var pinName, toPinPromises, objectKeys, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, parent, children, parentKey, objectKey, fromPinPromise, _ref, _ref2, pinned, toPin;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              pinName = this.getPinName(name);\n              toPinPromises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion = true;\n              _didIteratorError = false;\n              _iteratorError = undefined;\n              _context.prev = 6;\n\n              for (_iterator = objects[Symbol.iterator](); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                parent = _step.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n                children[parentKey] = parent._toFullJSON();\n\n                for (objectKey in children) {\n                  objectKeys.push(objectKey);\n                  toPinPromises.push(this.pinWithName(objectKey, [children[objectKey]]));\n                }\n              }\n\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](6);\n              _didIteratorError = true;\n              _iteratorError = _context.t0;\n\n            case 14:\n              _context.prev = 14;\n              _context.prev = 15;\n\n              if (!_iteratorNormalCompletion && _iterator.return != null) {\n                _iterator.return();\n              }\n\n            case 17:\n              _context.prev = 17;\n\n              if (!_didIteratorError) {\n                _context.next = 20;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 20:\n              return _context.finish(17);\n\n            case 21:\n              return _context.finish(14);\n\n            case 22:\n              fromPinPromise = this.fromPinWithName(pinName);\n              _context.next = 25;\n              return Promise.all([fromPinPromise, toPinPromises]);\n\n            case 25:\n              _ref = _context.sent;\n              _ref2 = _slicedToArray(_ref, 1);\n              pinned = _ref2[0];\n              toPin = _toConsumableArray(new Set([].concat(_toConsumableArray(pinned || []), objectKeys)));\n              return _context.abrupt(\"return\", this.pinWithName(pinName, toPin));\n\n            case 30:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[6, 10, 14, 22], [15,, 17, 21]]);\n    }));\n\n    function _handlePinAllWithName(_x, _x2) {\n      return _handlePinAllWithName2.apply(this, arguments);\n    }\n\n    return _handlePinAllWithName;\n  }(),\n  // Removes object and children keys from pin name\n  // Keeps the object and children pinned\n  _handleUnPinAllWithName: function () {\n    var _handleUnPinAllWithName2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var localDatastore, pinName, promises, objectKeys, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _objectKeys, parent, children, parentKey, pinned, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, objectKey, hasReference, key, pinnedObjects;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context2.sent;\n              pinName = this.getPinName(name);\n              promises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion2 = true;\n              _didIteratorError2 = false;\n              _iteratorError2 = undefined;\n              _context2.prev = 9;\n\n              for (_iterator2 = objects[Symbol.iterator](); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                parent = _step2.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n\n                (_objectKeys = objectKeys).push.apply(_objectKeys, [parentKey].concat(_toConsumableArray(Object.keys(children))));\n              }\n\n              _context2.next = 17;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](9);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context2.t0;\n\n            case 17:\n              _context2.prev = 17;\n              _context2.prev = 18;\n\n              if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                _iterator2.return();\n              }\n\n            case 20:\n              _context2.prev = 20;\n\n              if (!_didIteratorError2) {\n                _context2.next = 23;\n                break;\n              }\n\n              throw _iteratorError2;\n\n            case 23:\n              return _context2.finish(20);\n\n            case 24:\n              return _context2.finish(17);\n\n            case 25:\n              objectKeys = _toConsumableArray(new Set(objectKeys));\n              pinned = localDatastore[pinName] || [];\n              pinned = pinned.filter(function (item) {\n                return !objectKeys.includes(item);\n              });\n\n              if (pinned.length == 0) {\n                promises.push(this.unPinWithName(pinName));\n                delete localDatastore[pinName];\n              } else {\n                promises.push(this.pinWithName(pinName, pinned));\n                localDatastore[pinName] = pinned;\n              }\n\n              _iteratorNormalCompletion3 = true;\n              _didIteratorError3 = false;\n              _iteratorError3 = undefined;\n              _context2.prev = 32;\n              _iterator3 = objectKeys[Symbol.iterator]();\n\n            case 34:\n              if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                _context2.next = 51;\n                break;\n              }\n\n              objectKey = _step3.value;\n              hasReference = false;\n              _context2.t1 = _regeneratorRuntime.keys(localDatastore);\n\n            case 38:\n              if ((_context2.t2 = _context2.t1()).done) {\n                _context2.next = 47;\n                break;\n              }\n\n              key = _context2.t2.value;\n\n              if (!(key === _LocalDatastoreUtils.DEFAULT_PIN || key.startsWith(_LocalDatastoreUtils.PIN_PREFIX))) {\n                _context2.next = 45;\n                break;\n              }\n\n              pinnedObjects = localDatastore[key] || [];\n\n              if (!pinnedObjects.includes(objectKey)) {\n                _context2.next = 45;\n                break;\n              }\n\n              hasReference = true;\n              return _context2.abrupt(\"break\", 47);\n\n            case 45:\n              _context2.next = 38;\n              break;\n\n            case 47:\n              if (!hasReference) {\n                promises.push(this.unPinWithName(objectKey));\n              }\n\n            case 48:\n              _iteratorNormalCompletion3 = true;\n              _context2.next = 34;\n              break;\n\n            case 51:\n              _context2.next = 57;\n              break;\n\n            case 53:\n              _context2.prev = 53;\n              _context2.t3 = _context2[\"catch\"](32);\n              _didIteratorError3 = true;\n              _iteratorError3 = _context2.t3;\n\n            case 57:\n              _context2.prev = 57;\n              _context2.prev = 58;\n\n              if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                _iterator3.return();\n              }\n\n            case 60:\n              _context2.prev = 60;\n\n              if (!_didIteratorError3) {\n                _context2.next = 63;\n                break;\n              }\n\n              throw _iteratorError3;\n\n            case 63:\n              return _context2.finish(60);\n\n            case 64:\n              return _context2.finish(57);\n\n            case 65:\n              return _context2.abrupt(\"return\", Promise.all(promises));\n\n            case 66:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this, [[9, 13, 17, 25], [18,, 20, 24], [32, 53, 57, 65], [58,, 60, 64]]);\n    }));\n\n    function _handleUnPinAllWithName(_x3, _x4) {\n      return _handleUnPinAllWithName2.apply(this, arguments);\n    }\n\n    return _handleUnPinAllWithName;\n  }(),\n  // Retrieve all pointer fields from object recursively\n  _getChildren: function _getChildren(object\n  /*: ParseObject*/\n  ) {\n    var encountered = {};\n\n    var json = object._toFullJSON();\n\n    for (var key in json) {\n      if (json[key].__type && json[key].__type === 'Object') {\n        this._traverse(json[key], encountered);\n      }\n    }\n\n    return encountered;\n  },\n  _traverse: function _traverse(object\n  /*: any*/\n  , encountered\n  /*: any*/\n  ) {\n    if (!object.objectId) {\n      return;\n    } else {\n      var objectKey = this.getKeyForObject(object);\n\n      if (encountered[objectKey]) {\n        return;\n      }\n\n      encountered[objectKey] = object;\n    }\n\n    for (var key in object) {\n      var json = object[key];\n\n      if (!object[key]) {\n        json = object;\n      }\n\n      if (json.__type && json.__type === 'Object') {\n        this._traverse(json, encountered);\n      }\n    }\n  },\n  // Transform keys in pin name to objects\n  _serializeObjectsFromPinName: function () {\n    var _serializeObjectsFromPinName2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3(name\n    /*: string*/\n    ) {\n      var _this = this,\n          _ref3;\n\n      var localDatastore, allObjects, key, pinName, pinned, promises, objects;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context3.sent;\n              allObjects = [];\n\n              for (key in localDatastore) {\n                if (key.startsWith(_LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  allObjects.push(localDatastore[key][0]);\n                }\n              }\n\n              if (name) {\n                _context3.next = 7;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", allObjects);\n\n            case 7:\n              pinName = this.getPinName(name);\n              pinned = localDatastore[pinName];\n\n              if (Array.isArray(pinned)) {\n                _context3.next = 11;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", []);\n\n            case 11:\n              promises = pinned.map(function (objectKey) {\n                return _this.fromPinWithName(objectKey);\n              });\n              _context3.next = 14;\n              return Promise.all(promises);\n\n            case 14:\n              objects = _context3.sent;\n              objects = (_ref3 = []).concat.apply(_ref3, _toConsumableArray(objects));\n              return _context3.abrupt(\"return\", objects.filter(function (object) {\n                return object != null;\n              }));\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    function _serializeObjectsFromPinName(_x5) {\n      return _serializeObjectsFromPinName2.apply(this, arguments);\n    }\n\n    return _serializeObjectsFromPinName;\n  }(),\n  // Replaces object pointers with pinned pointers\n  // The object pointers may contain old data\n  // Uses Breadth First Search Algorithm\n  _serializeObject: function () {\n    var _serializeObject2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4(objectKey\n    /*: string*/\n    , localDatastore\n    /*: any*/\n    ) {\n      var LDS, root, queue, meta, uniqueId, nodeId, subTreeRoot, field, value, key, pointer;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              LDS = localDatastore;\n\n              if (LDS) {\n                _context4.next = 5;\n                break;\n              }\n\n              _context4.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              LDS = _context4.sent;\n\n            case 5:\n              if (!(!LDS[objectKey] || LDS[objectKey].length === 0)) {\n                _context4.next = 7;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", null);\n\n            case 7:\n              root = LDS[objectKey][0];\n              queue = [];\n              meta = {};\n              uniqueId = 0;\n              meta[uniqueId] = root;\n              queue.push(uniqueId);\n\n              while (queue.length !== 0) {\n                nodeId = queue.shift();\n                subTreeRoot = meta[nodeId];\n\n                for (field in subTreeRoot) {\n                  value = subTreeRoot[field];\n\n                  if (value.__type && value.__type === 'Object') {\n                    key = this.getKeyForObject(value);\n\n                    if (LDS[key] && LDS[key].length > 0) {\n                      pointer = LDS[key][0];\n                      uniqueId++;\n                      meta[uniqueId] = pointer;\n                      subTreeRoot[field] = pointer;\n                      queue.push(uniqueId);\n                    }\n                  }\n                }\n              }\n\n              return _context4.abrupt(\"return\", root);\n\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n\n    function _serializeObject(_x6, _x7) {\n      return _serializeObject2.apply(this, arguments);\n    }\n\n    return _serializeObject;\n  }(),\n  // Called when an object is save / fetched\n  // Update object pin value\n  _updateObjectIfPinned: function () {\n    var _updateObjectIfPinned2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5(object\n    /*: ParseObject*/\n    ) {\n      var objectKey, pinned;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context5.next = 2;\n                break;\n              }\n\n              return _context5.abrupt(\"return\");\n\n            case 2:\n              objectKey = this.getKeyForObject(object);\n              _context5.next = 5;\n              return this.fromPinWithName(objectKey);\n\n            case 5:\n              pinned = _context5.sent;\n\n              if (!(!pinned || pinned.length === 0)) {\n                _context5.next = 8;\n                break;\n              }\n\n              return _context5.abrupt(\"return\");\n\n            case 8:\n              return _context5.abrupt(\"return\", this.pinWithName(objectKey, [object._toFullJSON()]));\n\n            case 9:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    function _updateObjectIfPinned(_x8) {\n      return _updateObjectIfPinned2.apply(this, arguments);\n    }\n\n    return _updateObjectIfPinned;\n  }(),\n  // Called when object is destroyed\n  // Unpin object and remove all references from pin names\n  // TODO: Destroy children?\n  _destroyObjectIfPinned: function () {\n    var _destroyObjectIfPinned2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee6(object\n    /*: ParseObject*/\n    ) {\n      var localDatastore, objectKey, pin, promises, key, pinned;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context6.next = 2;\n                break;\n              }\n\n              return _context6.abrupt(\"return\");\n\n            case 2:\n              _context6.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context6.sent;\n              objectKey = this.getKeyForObject(object);\n              pin = localDatastore[objectKey];\n\n              if (pin) {\n                _context6.next = 9;\n                break;\n              }\n\n              return _context6.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(objectKey)];\n              delete localDatastore[objectKey];\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || key.startsWith(_LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if (pinned.includes(objectKey)) {\n                    pinned = pinned.filter(function (item) {\n                      return item !== objectKey;\n                    });\n\n                    if (pinned.length == 0) {\n                      promises.push(this.unPinWithName(key));\n                      delete localDatastore[key];\n                    } else {\n                      promises.push(this.pinWithName(key, pinned));\n                      localDatastore[key] = pinned;\n                    }\n                  }\n                }\n              }\n\n              return _context6.abrupt(\"return\", Promise.all(promises));\n\n            case 13:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    function _destroyObjectIfPinned(_x9) {\n      return _destroyObjectIfPinned2.apply(this, arguments);\n    }\n\n    return _destroyObjectIfPinned;\n  }(),\n  // Update pin and references of the unsaved object\n  _updateLocalIdForObject: function () {\n    var _updateLocalIdForObject2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee7(localId, object\n    /*: ParseObject*/\n    ) {\n      var localKey, objectKey, unsaved, promises, localDatastore, key, pinned;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context7.next = 2;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 2:\n              localKey = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX).concat(object.className, \"_\").concat(localId);\n              objectKey = this.getKeyForObject(object);\n              _context7.next = 6;\n              return this.fromPinWithName(localKey);\n\n            case 6:\n              unsaved = _context7.sent;\n\n              if (!(!unsaved || unsaved.length === 0)) {\n                _context7.next = 9;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(localKey), this.pinWithName(objectKey, unsaved)];\n              _context7.next = 12;\n              return this._getAllContents();\n\n            case 12:\n              localDatastore = _context7.sent;\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || key.startsWith(_LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if (pinned.includes(localKey)) {\n                    pinned = pinned.filter(function (item) {\n                      return item !== localKey;\n                    });\n                    pinned.push(objectKey);\n                    promises.push(this.pinWithName(key, pinned));\n                    localDatastore[key] = pinned;\n                  }\n                }\n              }\n\n              return _context7.abrupt(\"return\", Promise.all(promises));\n\n            case 15:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    function _updateLocalIdForObject(_x10, _x11) {\n      return _updateLocalIdForObject2.apply(this, arguments);\n    }\n\n    return _updateLocalIdForObject;\n  }(),\n\n  /**\n   * Updates Local Datastore from Server\n   *\n   * <pre>\n   * await Parse.LocalDatastore.updateFromServer();\n   * </pre>\n   * @method updateFromServer\n   * @name Parse.LocalDatastore.updateFromServer\n   * @static\n   */\n  updateFromServer: function () {\n    var _updateFromServer = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee8() {\n      var _this2 = this;\n\n      var localDatastore, keys, key, pointersHash, _i, _keys, _key, _key$split, _key$split2, className, objectId, queryPromises, responses, objects, pinPromises;\n\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              if (!(!this.checkIfEnabled() || this.isSyncing)) {\n                _context8.next = 2;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 2:\n              _context8.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context8.sent;\n              keys = [];\n\n              for (key in localDatastore) {\n                if (key.startsWith(_LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  keys.push(key);\n                }\n              }\n\n              if (!(keys.length === 0)) {\n                _context8.next = 9;\n                break;\n              }\n\n              return _context8.abrupt(\"return\");\n\n            case 9:\n              this.isSyncing = true;\n              pointersHash = {};\n\n              for (_i = 0, _keys = keys; _i < _keys.length; _i++) {\n                _key = _keys[_i];\n                // Ignore the OBJECT_PREFIX\n                _key$split = _key.split('_'), _key$split2 = _slicedToArray(_key$split, 4), className = _key$split2[2], objectId = _key$split2[3];\n\n                if (!(className in pointersHash)) {\n                  pointersHash[className] = new Set();\n                }\n\n                pointersHash[className].add(objectId);\n              }\n\n              queryPromises = Object.keys(pointersHash).map(function (className) {\n                var objectIds = Array.from(pointersHash[className]);\n                var query = new _ParseQuery.default(className);\n                query.limit(objectIds.length);\n\n                if (objectIds.length === 1) {\n                  query.equalTo('objectId', objectIds[0]);\n                } else {\n                  query.containedIn('objectId', objectIds);\n                }\n\n                return query.find();\n              });\n              _context8.prev = 13;\n              _context8.next = 16;\n              return Promise.all(queryPromises);\n\n            case 16:\n              responses = _context8.sent;\n              objects = [].concat.apply([], responses);\n              pinPromises = objects.map(function (object) {\n                var objectKey = _this2.getKeyForObject(object);\n\n                return _this2.pinWithName(objectKey, object._toFullJSON());\n              });\n              _context8.next = 21;\n              return Promise.all(pinPromises);\n\n            case 21:\n              this.isSyncing = false;\n              _context8.next = 28;\n              break;\n\n            case 24:\n              _context8.prev = 24;\n              _context8.t0 = _context8[\"catch\"](13);\n              console.error('Error syncing LocalDatastore: ', _context8.t0);\n              this.isSyncing = false;\n\n            case 28:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, this, [[13, 24]]);\n    }));\n\n    function updateFromServer() {\n      return _updateFromServer.apply(this, arguments);\n    }\n\n    return updateFromServer;\n  }(),\n  getKeyForObject: function getKeyForObject(object\n  /*: any*/\n  ) {\n    var objectId = object.objectId || object._getId();\n\n    return \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX).concat(object.className, \"_\").concat(objectId);\n  },\n  getPinName: function getPinName(pinName\n  /*: ?string*/\n  ) {\n    if (!pinName || pinName === _LocalDatastoreUtils.DEFAULT_PIN) {\n      return _LocalDatastoreUtils.DEFAULT_PIN;\n    }\n\n    return _LocalDatastoreUtils.PIN_PREFIX + pinName;\n  },\n  checkIfEnabled: function checkIfEnabled() {\n    if (!this.isEnabled) {\n      console.error('Parse.enableLocalDatastore() must be called first');\n    }\n\n    return this.isEnabled;\n  }\n};\nLocalDatastore.isEnabled = false;\nLocalDatastore.isSyncing = false;\nmodule.exports = LocalDatastore;\n\n_CoreManager.default.setLocalDatastoreController(require('./LocalDatastoreController.default'));\n\n_CoreManager.default.setLocalDatastore(LocalDatastore);","map":null,"metadata":{},"sourceType":"script"}