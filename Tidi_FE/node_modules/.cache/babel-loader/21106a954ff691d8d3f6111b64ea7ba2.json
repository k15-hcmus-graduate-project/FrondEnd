{"ast":null,"code":"import _classCallCheck from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/products/ProductDetail/ProductDetail.jsx\";\n// StyleSheets\nimport React, { Component } from \"react\";\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { FacebookProvider, Comments } from \"react-facebook\";\nimport \"./ProductDetail.scss\";\nimport WebService from \"../../../services/WebService\";\nimport AuthService from \"../../../services/AuthService\";\nimport { showAlert } from \"../../../helpers/lib\";\nimport { withCommas } from \"../../../helpers/lib\";\nimport Loader from \"../../common/Loader/Loader\";\nvar INTITIAL_STATE = {\n  product: {},\n  productFound: false\n};\n\nvar ProductDetail =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ProductDetail, _Component);\n\n  function ProductDetail(props) {\n    var _this;\n\n    _classCallCheck(this, ProductDetail);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProductDetail).call(this, props));\n\n    _this.componentWillMount = function () {\n      _this.fetchProduct();\n    };\n\n    _this.componentWillUpdate = function (nextProps) {\n      if (nextProps.match.params.id !== _this.props.match.params.id) {\n        _this.fetchProduct();\n      }\n    };\n\n    _this.doSomethingBeforeUnload = function () {\n      WebService.descViewer(_this.state.product.id).then(function (res) {\n        console.log(\"descrease viewer by one\");\n      });\n    };\n\n    _this.setupBeforeUnloadListener = function () {\n      window.addEventListener(\"beforeunload\", function (ev) {\n        console.log(\"close windows\");\n        ev.preventDefault();\n        return _this.doSomethingBeforeUnload();\n      });\n    };\n\n    _this.componentWillUnmount = function () {\n      console.log(\"da roi khoi trang\");\n      console.log(_this.state.product);\n      WebService.descViewer(_this.state.product.id).then(function (res) {\n        console.log(\"descrease viewer by one\");\n      });\n    };\n\n    _this.fetchProduct = function () {\n      var productId = Number(_this.props.match.params.id);\n\n      if (!isNaN(productId) && productId > 0) {\n        WebService.getProduct(productId).then(function (res) {\n          var product = JSON.parse(res);\n          console.log(product);\n\n          if (product.status !== 500) {\n            product.images = JSON.parse(product.images);\n\n            _this.setState({\n              product: product,\n              productFound: true\n            });\n          } else {\n            console.log(product);\n          }\n        });\n      }\n    };\n\n    _this.fetchCartProducts = function () {\n      var isLoggedIn = _this.props.isLoggedIn;\n\n      if (isLoggedIn) {\n        WebService.getCart(AuthService.getTokenUnsafe()).then(function (res) {\n          var result = JSON.parse(res);\n\n          if (result.status.status === \"TRUE\") {\n            if (result.products) {\n              result.products.forEach(function (prd) {\n                return prd.images = JSON.parse(prd.images);\n              });\n            }\n\n            _this.props.updateCartProducts(result.products);\n          }\n        });\n      }\n    };\n\n    _this.handleAddProductToCart = function (product) {\n      var _this$props = _this.props,\n          isLoggedIn = _this$props.isLoggedIn,\n          cart = _this$props.cart;\n\n      if (isLoggedIn) {\n        var currentCartItems = cart.products;\n\n        if (product.id) {\n          var cartItemAmount = 0;\n\n          if (currentCartItems) {\n            //  no-unused-vars\n            _.map(currentCartItems, function (cartItem) {\n              if (cartItem.id === product.id) {\n                cartItemAmount = cartItem.amount;\n              }\n            });\n          }\n\n          cartItemAmount += 1;\n          WebService.addItemToCart(AuthService.getTokenUnsafe(), product.id, cartItemAmount).then(function (r) {\n            var res = JSON.parse(r);\n\n            if (res.status) {\n              showAlert(\"Added \".concat(product.productName, \" to Cart!\"));\n\n              _this.fetchCartProducts();\n            }\n          });\n        }\n      } else {\n        showAlert(\"You have not logged in yet\", \"error\");\n      }\n    };\n\n    _this.generatePictures = function () {\n      var r = [];\n      var images = _this.state.product.images;\n\n      if (images) {\n        images.forEach(function (imageURL, index) {\n          r.push(React.createElement(\"div\", {\n            key: index,\n            className: \"carousel-item\" + (index === 0 ? \" active\" : \"\"),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 136\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            className: \"d-block w-100\",\n            src: imageURL,\n            alt: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 137\n            },\n            __self: this\n          })));\n        });\n      }\n\n      return r;\n    };\n\n    _this.render = function () {\n      var _this$state = _this.state,\n          productFound = _this$state.productFound,\n          product = _this$state.product;\n\n      if (!productFound) {\n        return React.createElement(\"div\", {\n          className: \"d-flex justify-content-center p-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }, \"Product not found\");\n      } else if (Object.keys(product).length === 0 || !_this.state.product) {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        });\n      } else {\n        var discountedPercent = Math.round(product.discPercent * 100);\n        var discountedPrice = Math.round(product.price - product.price * product.discPercent);\n        var listdescription = product.description.split(\"\\n\");\n        var listDescription = [];\n\n        for (var j = 0; j < listdescription.length; j++) {\n          listDescription[j] = React.createElement(\"p\", {\n            key: j,\n            className: \"product-desc\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 159\n            },\n            __self: this\n          }, listdescription[j]);\n        }\n\n        return React.createElement(\"div\", {\n          className: \"single_product_details_area d-flex align-items-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          id: \"images-slider\",\n          className: \"single_product_thumb carousel slide\",\n          \"data-ride\": \"carousel\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"carousel-inner\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 167\n          },\n          __self: this\n        }, _this.generatePictures()), React.createElement(\"a\", {\n          className: \"carousel-control-prev owl-prev\",\n          href: \"#images-slider\",\n          role: \"button\",\n          \"data-slide\": \"prev\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"fa fa-chevron-circle-left fa-5x\",\n          \"aria-hidden\": \"false\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"sr-only\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170\n          },\n          __self: this\n        }, \"Previous\")), React.createElement(\"a\", {\n          className: \"carousel-control-next owl-next\",\n          href: \"#images-slider\",\n          role: \"button\",\n          \"data-slide\": \"next\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"fa fa-chevron-circle-right fa-5x\",\n          \"aria-hidden\": \"false\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"sr-only\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, \"Next\"))), React.createElement(\"div\", {\n          className: \"single_product_desc clearfix\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }, product.brand && product.brand[0].brand_name), React.createElement(\"a\", {\n          href: \"cart.html\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, React.createElement(\"h2\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, product.product_name)), React.createElement(\"p\", {\n          className: \"product-price\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        }, product.discPercent !== 0 && React.createElement(\"span\", {\n          className: \"old-price\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }, withCommas(product.price) + \" ₫\"), withCommas(discountedPrice) + \" ₫  \", discountedPercent ? \"(-\" + discountedPercent + \"%)\" : null), React.createElement(\"h4\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }, listDescription), React.createElement(\"form\", {\n          className: \"cart-form clearfix\",\n          method: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"cart-fav-box d-flex align-items-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          type: \"button\",\n          name: \"addtocart\",\n          className: \"btn essence-btn\",\n          onClick: function onClick() {\n            return _this.handleAddProductToCart(product);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }, \"Add to cart\"), React.createElement(\"div\", {\n          className: \"product-favourite ml-4\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"#/\",\n          className: \"favme fa fa-heart\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 206\n          },\n          __self: this\n        })))), React.createElement(\"div\", {\n          className: \"cart-fav-box d-flex align-items-center justify-content-end\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212\n          },\n          __self: this\n        }, product.category && product.category[0].category_name)))), React.createElement(\"div\", {\n          className: \"full-description-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, product.description)), React.createElement(\"div\", {\n          className: \"fb-comment-plugin-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 222\n          },\n          __self: this\n        }, React.createElement(FacebookProvider, {\n          appId: \"486326855227569\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 223\n          },\n          __self: this\n        }, React.createElement(Comments, {\n          href: \"https://tidi-binpossible49.c9users.io\" + _this.props.location.pathname,\n          className: \"kdjf\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 224\n          },\n          __self: this\n        }))));\n      }\n    };\n\n    _this.state = INTITIAL_STATE;\n    return _this;\n  }\n\n  _createClass(ProductDetail, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Activate the event listener\n      this.setupBeforeUnloadListener();\n    }\n  }]);\n\n  return ProductDetail;\n}(Component);\n\nProductDetail.propTypes = {\n  isLoggedIn: PropTypes.bool,\n  updateCartProducts: PropTypes.func,\n  cart: PropTypes.shape({\n    products: PropTypes.array\n  })\n};\nexport default ProductDetail;","map":{"version":3,"sources":["/Users/lap12548/Documents/hcmus/TOTNGHIEP/GITHUB/FrondEnd/Tidi_FE/src/pages/products/ProductDetail/ProductDetail.jsx"],"names":["React","Component","_","PropTypes","FacebookProvider","Comments","WebService","AuthService","showAlert","withCommas","Loader","INTITIAL_STATE","product","productFound","ProductDetail","props","componentWillMount","fetchProduct","componentWillUpdate","nextProps","match","params","id","doSomethingBeforeUnload","descViewer","state","then","res","console","log","setupBeforeUnloadListener","window","addEventListener","ev","preventDefault","componentWillUnmount","productId","Number","isNaN","getProduct","JSON","parse","status","images","setState","fetchCartProducts","isLoggedIn","getCart","getTokenUnsafe","result","products","forEach","prd","updateCartProducts","handleAddProductToCart","cart","currentCartItems","cartItemAmount","map","cartItem","amount","addItemToCart","r","productName","generatePictures","imageURL","index","push","render","Object","keys","length","discountedPercent","Math","round","discPercent","discountedPrice","price","listdescription","description","split","listDescription","j","brand","brand_name","product_name","category","category_name","location","pathname","propTypes","bool","func","shape","array"],"mappings":"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","sourcesContent":["// StyleSheets\nimport React, { Component } from \"react\";\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { FacebookProvider, Comments } from \"react-facebook\";\nimport \"./ProductDetail.scss\";\nimport WebService from \"../../../services/WebService\";\nimport AuthService from \"../../../services/AuthService\";\nimport { showAlert } from \"../../../helpers/lib\";\nimport { withCommas } from \"../../../helpers/lib\";\nimport Loader from \"../../common/Loader/Loader\";\n\nconst INTITIAL_STATE = {\n    product: {},\n    productFound: false\n};\n\nclass ProductDetail extends Component {\n    static propTypes = {\n        isLoggedIn: PropTypes.bool,\n        updateCartProducts: PropTypes.func,\n        cart: PropTypes.shape({\n            products: PropTypes.array\n        })\n    };\n\n    constructor(props: any) {\n        super(props);\n        this.state = INTITIAL_STATE;\n    }\n\n    componentWillMount = () => {\n        this.fetchProduct();\n    };\n\n    componentWillUpdate = nextProps => {\n        if (nextProps.match.params.id !== this.props.match.params.id) {\n            this.fetchProduct();\n        }\n    };\n\n    doSomethingBeforeUnload = () => {\n        WebService.descViewer(this.state.product.id).then(res => {\n            console.log(\"descrease viewer by one\");\n        });\n    };\n\n    // Setup the `beforeunload` event listener\n    setupBeforeUnloadListener = () => {\n        window.addEventListener(\"beforeunload\", ev => {\n            console.log(\"close windows\");\n            ev.preventDefault();\n            return this.doSomethingBeforeUnload();\n        });\n    };\n\n    componentDidMount() {\n        // Activate the event listener\n        this.setupBeforeUnloadListener();\n    }\n    componentWillUnmount = () => {\n        console.log(\"da roi khoi trang\");\n        console.log(this.state.product);\n        WebService.descViewer(this.state.product.id).then(res => {\n            console.log(\"descrease viewer by one\");\n        });\n    };\n    fetchProduct = () => {\n        const productId = Number(this.props.match.params.id);\n        if (!isNaN(productId) && productId > 0) {\n            WebService.getProduct(productId).then(res => {\n                const product = JSON.parse(res);\n                console.log(product);\n                if (product.status !== 500) {\n                    product.images = JSON.parse(product.images);\n                    this.setState({\n                        product,\n                        productFound: true\n                    });\n                } else {\n                    console.log(product);\n                }\n            });\n        }\n    };\n\n    fetchCartProducts = () => {\n        const { isLoggedIn } = this.props;\n        if (isLoggedIn) {\n            WebService.getCart(AuthService.getTokenUnsafe()).then(res => {\n                const result = JSON.parse(res);\n                if (result.status.status === \"TRUE\") {\n                    if (result.products) {\n                        result.products.forEach(prd => (prd.images = JSON.parse(prd.images)));\n                    }\n                    this.props.updateCartProducts(result.products);\n                }\n            });\n        }\n    };\n\n    handleAddProductToCart = (product: any) => {\n        const { isLoggedIn, cart } = this.props;\n        if (isLoggedIn) {\n            const currentCartItems = cart.products;\n            if (product.id) {\n                let cartItemAmount = 0;\n                if (currentCartItems) {\n                    //  no-unused-vars\n                    _.map(currentCartItems, cartItem => {\n                        if (cartItem.id === product.id) {\n                            cartItemAmount = cartItem.amount;\n                        }\n                    });\n                }\n                cartItemAmount += 1;\n                WebService.addItemToCart(AuthService.getTokenUnsafe(), product.id, cartItemAmount).then(r => {\n                    const res = JSON.parse(r);\n                    if (res.status) {\n                        showAlert(`Added ${product.productName} to Cart!`);\n                        this.fetchCartProducts();\n                    }\n                });\n            }\n        } else {\n            showAlert(\"You have not logged in yet\", \"error\");\n        }\n    };\n\n    generatePictures = () => {\n        let r = [];\n        const { images } = this.state.product;\n        if (images) {\n            images.forEach((imageURL, index) => {\n                r.push(\n                    <div key={index} className={\"carousel-item\" + (index === 0 ? \" active\" : \"\")}>\n                        <img className=\"d-block w-100\" src={imageURL} alt=\"\" />\n                    </div>\n                );\n            });\n        }\n\n        return r;\n    };\n\n    render = () => {\n        const { productFound, product } = this.state;\n        if (!productFound) {\n            return <div className=\"d-flex justify-content-center p-5\">Product not found</div>;\n        } else if (Object.keys(product).length === 0 || !this.state.product) {\n            return <Loader />;\n        } else {\n            const discountedPercent = Math.round(product.discPercent * 100);\n            const discountedPrice = Math.round(product.price - product.price * product.discPercent);\n            const listdescription = product.description.split(\"\\n\");\n            const listDescription = [];\n            for (var j = 0; j < listdescription.length; j++) {\n                listDescription[j] = (\n                    <p key={j} className=\"product-desc\">\n                        {listdescription[j]}\n                    </p>\n                );\n            }\n            return (\n                <div className=\"single_product_details_area d-flex align-items-center\">\n                    <div id=\"images-slider\" className=\"single_product_thumb carousel slide\" data-ride=\"carousel\">\n                        <div className=\"carousel-inner\">{this.generatePictures()}</div>\n                        <a className=\"carousel-control-prev owl-prev\" href=\"#images-slider\" role=\"button\" data-slide=\"prev\">\n                            <span className=\"fa fa-chevron-circle-left fa-5x\" aria-hidden=\"false\" />\n                            <span className=\"sr-only\">Previous</span>\n                        </a>\n                        <a className=\"carousel-control-next owl-next\" href=\"#images-slider\" role=\"button\" data-slide=\"next\">\n                            <span className=\"fa fa-chevron-circle-right fa-5x\" aria-hidden=\"false\" />\n                            <span className=\"sr-only\">Next</span>\n                        </a>\n                    </div>\n\n                    {/* <!-- Single Product Description --> */}\n                    <div className=\"single_product_desc clearfix\">\n                        <span>{product.brand && product.brand[0].brand_name}</span>\n                        <a href=\"cart.html\">\n                            <h2>{product.product_name}</h2>\n                        </a>\n                        <p className=\"product-price\">\n                            {product.discPercent !== 0 && <span className=\"old-price\">{withCommas(product.price) + \" ₫\"}</span>}\n                            {withCommas(discountedPrice) + \" ₫  \"}\n                            {discountedPercent ? \"(-\" + discountedPercent + \"%)\" : null}\n                        </p>\n                        <h4>{listDescription}</h4>\n                        {/* <!-- Form --> */}\n                        <form className=\"cart-form clearfix\" method=\"post\">\n                            {/* <!-- Cart & Favourite Box --> */}\n                            <div className=\"cart-fav-box d-flex align-items-center\">\n                                {/* <!-- Cart --> */}\n                                <button\n                                    type=\"button\"\n                                    name=\"addtocart\"\n                                    className=\"btn essence-btn\"\n                                    onClick={() => this.handleAddProductToCart(product)}\n                                >\n                                    Add to cart\n                                </button>\n                                {/* <!-- Favourite --> */}\n                                <div className=\"product-favourite ml-4\">\n                                    <a href=\"#/\" className=\"favme fa fa-heart\">\n                                        <span />\n                                    </a>\n                                </div>\n                            </div>\n\n                            <div className=\"cart-fav-box d-flex align-items-center justify-content-end\">\n                                <a href=\"/\">{product.category && product.category[0].category_name}</a>\n                            </div>\n                        </form>\n                    </div>\n\n                    {/* PRODUCT FULL DESCRIPTION */}\n                    <div className=\"full-description-container\">\n                        <div className=\"container\">{product.description}</div>\n                    </div>\n\n                    <div className=\"fb-comment-plugin-container\">\n                        <FacebookProvider appId=\"486326855227569\">\n                            <Comments href={\"https://tidi-binpossible49.c9users.io\" + this.props.location.pathname} className=\"kdjf\" />\n                        </FacebookProvider>\n                    </div>\n                </div>\n            );\n        }\n    };\n}\n\nexport default ProductDetail;\n"]},"metadata":{},"sourceType":"module"}